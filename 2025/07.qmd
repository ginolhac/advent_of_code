---
title: "07"
format: html
---

```{r}
#| label: setup
#| include: false
library(tidyverse)
library(adventdrob)
```


```{r}
input <- ".......S.......
...............
.......^.......
...............
......^.^......
...............
.....^.^.^.....
...............
....^.^...^....
...............
...^.^...^.^...
...............
..^...^.....^..
...............
.^.^.^.^.^...^.
...............
"

#input <- "input/07"

pmat <- tibble(x = read_lines(input)) |> 
  grid_matrix(var = x)
# structure with a list of list, first level = row, second each beam coordinates (row, col)
beamer <- vector(mode = "list", length = nrow(pmat))
pos <- 1
                   # row, col
beamer[[pos]] <- list(c(pos, which(pmat[1,] == "S")))
nb_split <- 0
nb_dup <- 0L

beamer_split <- function(pos) {
  # check if blocker are present for every beamer on this row
  for (beam in beamer[[pos - 1]]) {
    if (pmat[pos, beam[2]] == '^') {
      beamer[[pos]] <<- append(beamer[[pos]], list(c(pos, beam[2] - 1), c(pos, beam[2] + 1)))
      lgt <- length(beamer[[pos]])
      # remove duplicates
      beamer[[pos]] <<- unique(beamer[[pos]])
      # how many replicates we got
      nb_dup <<- nb_dup + (lgt - length(beamer[[pos]]))
      nb_split <<- nb_split + 1
      
    } else { # we just go down but each beam from above
      beamer[[pos]] <<- append(beamer[[pos]], list(c(pos, beam[2])))
    }
  }
}

while (pos < nrow(pmat) - 1) {
  pos <- pos + 1
  beamer_split(pos)
 # message(paste("row ", pos))
}
nb_split
```

